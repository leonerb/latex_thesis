%<*Figure:multilabel-struc>
\begin{figure}[h]
	\centering
    \includegraphics[width=\textwidth]{figures/multilabel-struc.pdf}
    \caption{Hierarchical structure of the CheXpert dataset. 
	The labels are grouped into 14 categories.
	The dotted arrow from the Support Devices class indicates, that patients with a support device can also be labeled as No Finding, representing the only source of overlap between the No Finding class and other classes.
	Adapted from \citep{Irvin2019}.}
    \label{fig:multilabel-struc}
\end{figure}
%</Figure:multilabel-struc>

%<*Figure:pathologies>
\begin{figure}[htbp]
	\centering
	\begin{subfigure}[t]{0.3\textwidth}
		\includegraphics[width=\textwidth, height=\textwidth]{figures/pathologies/cardiomegaly.png}
		\caption{Cardiomegaly}
		%\label{fig:first}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.3\textwidth}
		\includegraphics[width=\textwidth, height=\textwidth]{figures/pathologies/pneumonia.jpg}
		\caption{Pneumonia}
		%\label{fig:second}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.3\textwidth}
		\includegraphics[width=\textwidth, height=\textwidth]{figures/pathologies/rib-fracture.PNG}
		\caption{Rib Fracture}
		%\label{fig:third}
	\end{subfigure}
	\hfill
	\vskip 1pt
	\begin{subfigure}[t]{0.3\textwidth}
		\includegraphics[width=\textwidth, height=\textwidth]{figures/pathologies/pneumothorax.png}
		\caption{Pneumothorax}
		%\label{fig:fourth}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.3\textwidth}
		\includegraphics[width=\textwidth, height=\textwidth]{figures/pathologies/lung opacity.png}
		\caption{Lung Opacity}
		%\label{fig:fifth}
	\end{subfigure}
	\hfill
	\begin{subfigure}[t]{0.3\textwidth}
		\includegraphics[width=\textwidth, height=\textwidth]{figures/pathologies/pleural effusion.png}
		\caption{Pleural Effusion}
		%\label{fig:sixth}
	\end{subfigure}	
	\caption{Pathologies, neu machen mit CheXpert Bildern}
	\label{fig:pathologies}
\end{figure}
%</Figure:pathologies>

%<*Figure:vit-arch>
\begin{figure}[ht]
	\centering
    \includegraphics[width=\textwidth]{figures/vit_arch_new.drawio.pdf}
	\caption{Architecture of DINO head with ViT Transformer as backbone. Adapted from \citep{Dosovitskiy2020}. 
    The Chest X-ray image is taken from the CheXpert dataset \citep{Irvin2019}.}
	\label{fig:vit-arch}
\end{figure}
%</Figure:vit-arch>

%<*Figure:simclr-arch>
\begin{figure}[ht]
	\centering
    \includegraphics[width=\textwidth]{figures/simclr-arch-new.pdf}
	\caption{SimCLR architecture, adapted from \citep{Chen2020}. 
	The Chest X-ray image is taken from the CheXpert dataset \citep{Irvin2019}.
	}
	\label{fig:simclr-arch}
\end{figure}
%</Figure:simclr-arch>

%<*Figure:dino-arch>
\begin{figure}[ht]
	\centering
    \includegraphics[width=\textwidth]{figures/dino-arch-new.pdf}
	\caption{DINO architecture, adapted from \citep{Caron2021}.
	Exponential moving average is abbreviated as EMA.
	The crossed out gradient $\cancel{\nabla}$ indicates, that there is a gradient back propagation for the student- but \textbf{not} for the teacher weights [ibid.].
	}
	\label{fig:dino-arch}
\end{figure}
%</Figure:dino-arch>

%<*Figure:setting1-chexnorm-v-imgnorm>
\begin{figure}[!htbp]
	\begin{subtable}[c]{\textwidth}
		\renewcommand{\arraystretch}{1.5}
		\centering
		\begin{tabular}{l c c c c} 
		\toprule
		& \multicolumn{2}{c}{SimCLR} & \multicolumn{2}{c}{DINO}\\
		\cmidrule(lr){2-3} \cmidrule(lr){4-5}
		normalization& CheXpert&ImageNet&CheXpert&ImageNet\\
		\midrule
		Cardiomegaly&57.81&55.26&58.24&\textbf{60.33}\\
		Fracture&53.43&54.53&\textbf{56.43}&55.69\\
		Lung Opacity&55.55&55.49&59.10&\textbf{60.30}\\
		Pleural Effusion&58.48&58.05&\textbf{64.33}&61.56\\
		Pneumothorax&60.10&60.54&57.51&\textbf{61.23}\\
		Support Devices&53.58&53.50&56.97&\textbf{57.44}\\
		\bottomrule
		\end{tabular}
		\caption{AUROC 1 values for last epoch}
		\label{fig:setting1-chexnorm-v-imgnorm-dino-last-epoch}
	\end{subtable}
	\\[.2cm]
	\begin{subfigure}[t]{\textwidth}
		\centering
		\input{figures/setting1-imagenet-norm-dino-v-simclr-barplot.pgf}
		\caption{AUROC 1 values for last epoch for ImageNet normalization}
		\label{fig:setting1-chexnorm-v-imgnorm-dino-barplot}
	\end{subfigure}
    \caption{Comparison between Chexpert and ImageNet normalization for the first setting.
	Table \ref{fig:setting1-chexnorm-v-imgnorm-dino-last-epoch} shows the results for SimCLR and DINO respectively across both normalizations.
	Maximum AUROC values are marked in bold.
	Figure \ref{fig:setting1-chexnorm-v-imgnorm-dino-barplot} depicts the results for both models restricted to ImageNet normalization only.
	The dotted line refers to the performance equivalent to the chance level at 50\% AUROC.
	For the ImageNet normalization, all images were scaled with $\mu=(0.485, 0.456, 0.406)$ and $\sigma=(0.229, 0.224, 0.225)$. 
    The CheXpert normalization stands for a normalization with $\mu=(0.5330, 0.5330, 0.5330)$ and $\sigma=(0.0349, 0.0349, 0.0349)$ \citep[\href{https://github.com/christophbrgr/ood_detection_framework}{\color{Periwinkle}{implementation}}]{Berger2021}.
	The ID class is No Finding and OOD classes are the ones that are mentioned in the plot.}
	\label{fig:setting1-chexnorm-v-imgnorm}
\end{figure}
%</Figure:setting1-chexnorm-v-imgnorm>

%<*Figure:auroc-vs-k-and-temp>
\begin{figure}[!htbp]
	\begin{subfigure}[t]{\textwidth}
		\centering
		\input{figures/auroc-vs-k.pgf}
		\caption{}
		%AUROC in relation to the number of nearest neighbours used for feature similarity.
		\label{fig:auroc-vs-k}
	\end{subfigure}
	\begin{subfigure}[t]{\textwidth}
		\centering
		\input{figures/auroc-vs-temp.pgf}
		\caption{}
		%AUROC of settings 1-3 compared to the temperature.
		\label{fig:auroc-vs-temp}
	\end{subfigure}
	\caption{The values for setting 1 were calculated as a top-3 average of the six OOD pathologies.
	$N_i$ refers to the length of the in-distribution train dataset of the i-th setting, where $i \in \{1,2,3\}$.
	The temperature is set to 1 for all values in figure \ref{fig:auroc-vs-k}.}
	\label{fig:auroc-vs-k-and-temp}
\end{figure}
%</Figure:auroc-vs-k-and-temp>

%<*Figure:dino-rotate-augs-v-default-augs>
\begin{figure}[ht]
	\centering
	\input{figures/dino-rotate-augs-vs-default-augs-new.pgf}
	\caption{Comparison of the adjusted DINO augmentations and the adapted Rotation augmentations used by \citep{Azizi2021}.
	\textcolor{red}{Setting 3 neu machen}}
	\label{fig:dino-rotate-augs-v-default-augs}
\end{figure}
%</Figure:dino-rotate-augs-v-default-augs>

%<*Figure:supervised-vs-unsupervised>
\begin{figure}[ht]
	\centering
	\input{figures/supervised-vs-unsupervised.pgf}
	\caption{Comparison of supervised and unsupervised models for setting 2 and setting 3.}
\end{figure}
%</Figure:supervised-vs-unsupervised>

%<*Figure:labels-used-AUC-setting1>
\begin{figure}
	\centering
    \includegraphics[width=\textwidth]{figures/labels-used-AUC-setting1.pdf}
    \caption{}
    \label{fig:labels-used-AUC-setting1}
\end{figure}
%</Figure:labels-used-AUC-setting1>

%<*Figure:labels-used-AUC-setting2>
\begin{figure}
	\centering
    \includegraphics[width=\textwidth]{figures/labels-used-AUC-setting2.pdf}
	\caption{}
	\label{fig:labels-used-AUC-setting2}
\end{figure}
%</Figure:labels-used-AUC-setting2>

%<*Figure:heatmap-geom>
\begin{figure}
	\centering
	\begin{subfigure}[t]{0.45\textwidth}
		\includegraphics[width=\textwidth, height=0.8\textwidth]{figures/heatmap-geom-acc.pdf}
		\caption{k-nn accuracy}
		%\label{fig:third}
	\end{subfigure}
	\begin{subfigure}[t]{0.45\textwidth}
		\includegraphics[width=\textwidth, height=0.8\textwidth]{figures/heatmap-geom-auroc.pdf}
		\caption{AUROC OOD}
		%\label{fig:third}
	\end{subfigure}
    % \includegraphics[width=\textwidth]{figures/heatmap-geom-acc.pdf}
    \caption{k-nn classification accuracy and AUROC for different geometrical augmentations.}
    \label{fig:heatmap-geom}
\end{figure}
%</Figure:heatmap-geom>

%<*Figure:heatmap-spatial>
\begin{figure}
	\centering
	\begin{subfigure}[t]{0.45\textwidth}
		\includegraphics[width=\textwidth, height=0.8\textwidth]{figures/heatmap-spatial-acc.pdf}
		\caption{k-nn accuracy}
		%\label{fig:third}
	\end{subfigure}
	\begin{subfigure}[t]{0.45\textwidth}
		\includegraphics[width=\textwidth, height=0.8\textwidth]{figures/heatmap-spatial-auroc.pdf}
		\caption{AUROC OOD}
		%\label{fig:third}
	\end{subfigure}
    % \includegraphics[width=\textwidth]{figures/heatmap-spatial-acc.pdf}
    \caption{k-nn classification accuracy and AUROC for different spatial augmentations.}
    \label{fig:heatmap-spatial}
\end{figure}
%</Figure:heatmap-spatial>

%<*Figure:heatmap-ood-auc>
\begin{figure}
	\centering
    \includegraphics[width=\textwidth]{figures/heatmap-ood-auc.pdf}
    \caption{Averaged over both settings. 
	For a detailed breakdown of both settings see the appendix [\textcolor{red}{add REF}].}
    \label{fig:heatmap-ood-auc}
\end{figure}
%</Figure:heatmap-ood-auc>

%<*Figure:custom-augs-bbox>
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=\textwidth]{figures/custom_augs_bbox.pdf}
	\caption{Bounding boxes of the custom augmentations.
	The green bounding boxes represent border values, where possible slices are sampled on which the augmentations are applied. 
	The red bounding boxes represent those slices}
	\label{fig:custom-augs-bbox}
\end{figure}
%</Figure:custom-augs-bbox>

%<*Figure:custom-augs-applied>
\begin{figure}[!htbp]
	\centering
	\includegraphics[width=\textwidth]{figures/custom_augs_applied.pdf}
	\caption{Custom augmentations applied to a frontal chest-xray image.
	The simulated rib fracture is in the upper part of the right image side (left side of the patient).}
	\label{fig:custom-augs-applied}
\end{figure}
%</Figure:custom-augs-applied>




